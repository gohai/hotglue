$(document).ready(function(){var e=$('<img src="'+$.glue.base_url+'modules/webvideo/webvideo.png" alt="btn" title="embed a youtube or vimeo video" width="32" height="32">');$(e).bind("click",function(e){var a=prompt("Enter the video URL (e.g. http://www.youtube.com/watch?v=_mdVHEus0T8)");if(a){var t=!1;if(-1!=a.indexOf("youtube")){var l=a.indexOf("v=");if(-1==l)$.glue.error("Error understanding the youtube link");else{l+=2;var i=a.indexOf("&",l);-1==i&&(i=a.length),t="youtube";var o=a.slice(l,i)}}else if(-1!=a.indexOf("vimeo")){var l=a.indexOf(".com/");if(-1==l)$.glue.error("Error understanding the vimeo link");else{l+=5,t="vimeo";var o=String(parseInt(a.slice(l)))}}else $.glue.error("Only youtube and vimeo videos are supported at the moment.");t&&$.glue.backend({method:"glue.create_object",page:$.glue.page},function(a){var l=$('<div class="webvideo resizable object" style="position: absolute;"></div>');if($(l).attr("id",a.name),"youtube"==t){var i="";i="https:"==location.protocol?"https://":"http://";var d=$('<iframe class="youtube-player" src="'+i+"www.youtube.com/embed/"+o+'?rel=0" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>')}else if("vimeo"==t)var d=$('<iframe src="http://player.vimeo.com/video/'+o+'?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff" style="border-width: 0px; height: 100%; position: absolute; width: 100%;"></iframe>');$(l).append(d),d=$('<div class="glue-webvideo-shield glue-ui" style="height: 100%; position: absolute; width: 100%;" title="visitors will be able to interact with the webpage below"></div>'),$(l).append(d),$("body").append(l),$(l).css("width",$(l).width()+"px"),$(l).css("height",$(l).height()+"px"),$(l).css("left",e.pageX-$(l).outerWidth()/2+"px"),$(l).css("top",e.pageY-$(l).outerHeight()/2+"px"),$.glue.object.register(l),$.glue.backend({method:"glue.update_object",name:$(l).attr("id"),"webvideo-provider":t,"webvideo-id":o}),$.glue.object.save(l)}),$.glue.menu.hide()}}),$.glue.menu.register("new",e,13);var e=$('<div style="height: 32px; width: 32px;" title="toggle automatic playback of video (takes effect after a reload)">');$(e).bind("glue-menu-activate",function(e){var a=$(this).data("owner");if(void 0===$(a).data("webvideo-autoplay")){$(this).removeClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled");var t=this;$.glue.backend({method:"glue.load_object",name:$(a).attr("id")},function(e){"autoplay"==e["webvideo-autoplay"]?($(t).addClass("glue-menu-enabled"),$(a).data("webvideo-autoplay","autoplay")):($(t).addClass("glue-menu-disabled"),$(a).data("webvideo-autoplay",""))})}else"autoplay"==$(a).data("webvideo-autoplay")?($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled")):($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"))}),$(e).bind("click",function(e){var a=$(this).data("owner");$(this).hasClass("glue-menu-enabled")?($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"),$(a).data("webvideo-autoplay","autoplay"),$.glue.backend({method:"glue.object_remove_attr",name:$(a).attr("id"),attr:"webvideo-autoplay"})):$(this).hasClass("glue-menu-disabled")&&($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),$(a).data("webvideo-autoplay",""),$.glue.backend({method:"glue.update_object",name:$(a).attr("id"),"webvideo-autoplay":"autoplay"}))}),$.glue.contextmenu.register("webvideo","webvideo-autoplay",e),e=$('<div style="height: 32px; width: 32px;" title="toggle looping of video (takes effect after a reload)">'),$(e).bind("glue-menu-activate",function(e){var a=$(this).data("owner");if(void 0===$(a).data("webvideo-loop")){$(this).removeClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled");var t=this;$.glue.backend({method:"glue.load_object",name:$(a).attr("id")},function(e){"loop"==e["webvideo-loop"]?($(t).addClass("glue-menu-enabled"),$(a).data("webvideo-loop","loop")):($(t).addClass("glue-menu-disabled"),$(a).data("webvideo-loop",""))})}else"loop"==$(a).data("webvideo-loop")?($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled")):($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"))}),$(e).bind("click",function(e){var a=$(this).data("owner");$(this).hasClass("glue-menu-enabled")?($(this).removeClass("glue-menu-enabled"),$(this).addClass("glue-menu-disabled"),$(a).data("webvideo-loop",""),$.glue.backend({method:"glue.object_remove_attr",name:$(a).attr("id"),attr:"webvideo-loop"})):$(this).hasClass("glue-menu-disabled")&&($(this).addClass("glue-menu-enabled"),$(this).removeClass("glue-menu-disabled"),$(a).data("webvideo-loop","loop"),$.glue.backend({method:"glue.update_object",name:$(a).attr("id"),"webvideo-loop":"loop"}))}),$.glue.contextmenu.register("webvideo","webvideo-loop",e),$.glue.object.register_alter_pre_save("iframe",function(e,a){$(e).children("iframe").html(""),$(e).children(".glue-webvideo-shield").remove()})});
